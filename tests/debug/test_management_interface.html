<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理介面測試報告</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        .data-display {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>LuckyGas 管理介面測試報告</h1>
    
    <div class="test-section">
        <h2>1. API 連線測試</h2>
        <button onclick="testAPIConnection()">測試 API 連線</button>
        <div id="api-status"></div>
    </div>
    
    <div class="test-section">
        <h2>2. 客戶資料顯示測試</h2>
        <button onclick="testClientData()">載入客戶資料</button>
        <div id="client-data"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Modal 功能測試</h2>
        <button onclick="testModal()">測試 Modal 視窗</button>
        <div id="modal-test"></div>
    </div>
    
    <div class="test-section">
        <h2>4. 客戶詳細資料測試</h2>
        <button onclick="testClientDetail()">測試客戶詳細資料</button>
        <div id="client-detail"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';
        
        async function testAPIConnection() {
            const statusDiv = document.getElementById('api-status');
            try {
                const response = await fetch(`${API_BASE}/../health`);
                const data = await response.json();
                statusDiv.innerHTML = `<p class="success">✓ API 連線成功</p>
                                     <div class="data-display">${JSON.stringify(data, null, 2)}</div>`;
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">✗ API 連線失敗: ${error.message}</p>`;
            }
        }
        
        async function testClientData() {
            const dataDiv = document.getElementById('client-data');
            try {
                const response = await fetch(`${API_BASE}/clients`);
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    let html = `<p class="success">✓ 成功載入 ${data.total} 筆客戶資料</p>`;
                    html += '<table>';
                    html += '<tr><th>客戶ID</th><th>客戶編號</th><th>客戶名稱</th><th>發票抬頭</th><th>地址</th><th>狀態</th></tr>';
                    
                    data.items.forEach(client => {
                        html += `<tr>
                            <td>${client.id}</td>
                            <td>${client.client_code || '-'}</td>
                            <td>${client.name || '-'}</td>
                            <td>${client.invoice_title || '-'}</td>
                            <td>${client.address}</td>
                            <td>${client.is_active ? '啟用' : '停用'}</td>
                        </tr>`;
                    });
                    html += '</table>';
                    
                    // 測試是否有 client_code 和 invoice_title
                    const hasClientCode = data.items.some(c => c.client_code);
                    const hasInvoiceTitle = data.items.some(c => c.invoice_title);
                    
                    html += '<h3>欄位檢查：</h3>';
                    html += `<p class="${hasClientCode ? 'success' : 'error'}">
                            ${hasClientCode ? '✓' : '✗'} 客戶編號 (client_code) 欄位存在</p>`;
                    html += `<p class="${hasInvoiceTitle ? 'success' : 'error'}">
                            ${hasInvoiceTitle ? '✓' : '✗'} 發票抬頭 (invoice_title) 欄位存在</p>`;
                    
                    dataDiv.innerHTML = html;
                } else {
                    dataDiv.innerHTML = '<p class="error">✗ 沒有客戶資料</p>';
                }
            } catch (error) {
                dataDiv.innerHTML = `<p class="error">✗ 載入失敗: ${error.message}</p>`;
            }
        }
        
        function testModal() {
            const modalDiv = document.getElementById('modal-test');
            
            // 建立簡單的 modal
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 8px; z-index: 1000;';
            modal.innerHTML = `
                <h3>測試 Modal</h3>
                <p>這是一個測試 modal 視窗</p>
                <button onclick="this.parentElement.remove()">關閉</button>
            `;
            
            document.body.appendChild(modal);
            modalDiv.innerHTML = '<p class="success">✓ Modal 功能正常</p>';
        }
        
        async function testClientDetail() {
            const detailDiv = document.getElementById('client-detail');
            try {
                // 先取得客戶列表
                const listResponse = await fetch(`${API_BASE}/clients`);
                const listData = await listResponse.json();
                
                if (listData.items && listData.items.length > 0) {
                    // 取第一個客戶的詳細資料
                    const clientId = listData.items[0].id;
                    const detailResponse = await fetch(`${API_BASE}/clients/${clientId}`);
                    const clientDetail = await detailResponse.json();
                    
                    let html = `<p class="success">✓ 成功載入客戶 ID ${clientId} 的詳細資料</p>`;
                    html += '<div class="data-display">';
                    html += `客戶ID: ${clientDetail.id}\n`;
                    html += `客戶編號: ${clientDetail.client_code || '無'}\n`;
                    html += `客戶名稱: ${clientDetail.name || '無'}\n`;
                    html += `發票抬頭: ${clientDetail.invoice_title || '無'}\n`;
                    html += `地址: ${clientDetail.address}\n`;
                    html += `聯絡人: ${clientDetail.contact_person || '無'}\n`;
                    html += `統一編號: ${clientDetail.tax_id || '無'}\n`;
                    html += `總訂單數: ${clientDetail.total_orders || 0}\n`;
                    html += `最後訂單日期: ${clientDetail.last_order_date || '無'}\n`;
                    html += `狀態: ${clientDetail.is_active ? '啟用' : '停用'}`;
                    html += '</div>';
                    
                    detailDiv.innerHTML = html;
                } else {
                    detailDiv.innerHTML = '<p class="error">✗ 沒有客戶資料可供測試</p>';
                }
            } catch (error) {
                detailDiv.innerHTML = `<p class="error">✗ 載入失敗: ${error.message}</p>`;
            }
        }
        
        // 自動執行所有測試
        window.onload = function() {
            setTimeout(() => {
                testAPIConnection();
                setTimeout(() => {
                    testClientData();
                    setTimeout(() => {
                        testClientDetail();
                    }, 1000);
                }, 1000);
            }, 500);
        };
    </script>
</body>
</html>