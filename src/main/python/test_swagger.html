<!DOCTYPE html>
<html>
<head>
    <title>Swagger UI Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Swagger UI Debug Test</h1>
    
    <div class="test-section">
        <h2>1. API Server Health Check</h2>
        <button onclick="testAPIHealth()">Test API Health</button>
        <div id="healthResult"></div>
    </div>

    <div class="test-section">
        <h2>2. OpenAPI Schema Test</h2>
        <button onclick="testOpenAPISchema()">Test OpenAPI Schema</button>
        <div id="schemaResult"></div>
    </div>

    <div class="test-section">
        <h2>3. API Endpoint Test</h2>
        <button onclick="testAPIEndpoint()">Test GET /api/clients</button>
        <div id="endpointResult"></div>
    </div>

    <div class="test-section">
        <h2>4. CORS Test</h2>
        <button onclick="testCORS()">Test CORS Headers</button>
        <div id="corsResult"></div>
    </div>

    <div class="test-section">
        <h2>5. Console Errors</h2>
        <pre id="consoleErrors">No errors captured yet. Open browser console to see real-time errors.</pre>
    </div>

    <script>
        // Capture console errors
        window.addEventListener('error', function(e) {
            document.getElementById('consoleErrors').innerHTML += 
                `Error: ${e.message} at ${e.filename}:${e.lineno}:${e.colno}\n`;
        });

        async function testAPIHealth() {
            const resultDiv = document.getElementById('healthResult');
            try {
                const response = await fetch('http://localhost:8000/health');
                const data = await response.json();
                resultDiv.innerHTML = `<span class="success">✓ Health check passed</span><pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">✗ Health check failed: ${error.message}</span>`;
            }
        }

        async function testOpenAPISchema() {
            const resultDiv = document.getElementById('schemaResult');
            try {
                const response = await fetch('http://localhost:8000/openapi.json');
                const data = await response.json();
                resultDiv.innerHTML = `<span class="success">✓ OpenAPI schema loaded</span><pre>${JSON.stringify({
                    info: data.info,
                    paths: Object.keys(data.paths || {}),
                    components: Object.keys(data.components || {})
                }, null, 2)}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">✗ Schema load failed: ${error.message}</span>`;
            }
        }

        async function testAPIEndpoint() {
            const resultDiv = document.getElementById('endpointResult');
            try {
                const response = await fetch('http://localhost:8000/api/clients', {
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                const data = await response.json();
                resultDiv.innerHTML = `<span class="success">✓ API call successful</span><pre>Status: ${response.status}
Items: ${data.items ? data.items.length : 0}
Total: ${data.total || 0}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">✗ API call failed: ${error.message}</span>`;
            }
        }

        async function testCORS() {
            const resultDiv = document.getElementById('corsResult');
            try {
                const response = await fetch('http://localhost:8000/api/clients', {
                    method: 'OPTIONS'
                });
                
                const headers = {};
                response.headers.forEach((value, key) => {
                    if (key.toLowerCase().includes('access-control')) {
                        headers[key] = value;
                    }
                });
                
                resultDiv.innerHTML = `<span class="success">✓ CORS headers present</span><pre>${JSON.stringify(headers, null, 2)}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">✗ CORS test failed: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>